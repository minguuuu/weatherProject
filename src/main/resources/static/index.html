<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>빼앰스</title>

  <link rel="stylesheet" type="text/css" href="css/mainCss.css">

  <!-- Google Chart -->
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>

  <!-- Jq Grid -->
  <link rel="stylesheet" href="css/jquery-ui.css">
  <link rel="stylesheet" href="css/ui.jqgrid.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>  
  <script>
    $.jgrid = $.jgrid || {};
    $.jgrid.no_legacy_api = true;
    $.jgrid.useJSON = true;
  </script>
  <script src="js/jquery.jqgrid.src.js"></script>

  <script type="text/javascript">

    window.onload = function() {
      nowDateData();
    }

    function nowDateData() {
      document.getElementById('dateSelect').valueAsDate = new Date();
      weatherData();
    }

    $(function() {
      $('#selectArea').on('change', function() {
        weatherData();
      })
    });

    function weatherData() {
      var dataType = $("#typeSelect option:selected").val();
      var selectDate = $("#dateSelect").val();
      var dataTemp = JSON.stringify({"dataType" : dataType, "selectDate" : selectDate});

      $('#reloadDiv').load(document.URL+' #outerDiv');

      $.ajax({
        type: "get",
        url: "logi/weatherData",
        dataType: "JSON",
        contentType: "application/json; charset=utf-8",
        data: { "data": dataTemp },
        success: function (result) {
          Object.keys(result).forEach(key => {
            if (result[key] == 0) {
              result[key] = null;
            }
          });
          var dataTypeName = "";
          if (result["dataType"] == 1) {
            dataTypeName = "온도";
          } else {
            dataTypeName = "습도";
          }
          drawGrid(result, dataTypeName);
          drawChart(result, dataTypeName);
        },
        error: function () {
          alert("해당하는 날의 데이터가 없습니다!");
          nowDateData();
        }
      })
    }

    //<!-- Jq Grid -->
    function drawGrid(val, dataTypeName) {
      $("#list").jqGrid({
        cellEdit: true,
        cellsubmit: 'remote',
        cellurl: 'logi/update',

        colModel: [
          { name: "시간" },
          { name: dataTypeName, editable: true }
        ],
        data: [
          { 시간: "0시", 온도: val['t00'], 습도: val['t00'] },
          { 시간: "1시", 온도: val['t01'], 습도: val['t01'] },
          { 시간: "2시", 온도: val['t02'], 습도: val['t02'] },
          { 시간: "3시", 온도: val['t03'], 습도: val['t03'] },
          { 시간: "4시", 온도: val['t04'], 습도: val['t04'] },
          { 시간: "5시", 온도: val['t05'], 습도: val['t05'] },
          { 시간: "6시", 온도: val['t06'], 습도: val['t06'] },
          { 시간: "7시", 온도: val['t07'], 습도: val['t07'] },
          { 시간: "8시", 온도: val['t08'], 습도: val['t08'] },
          { 시간: "9시", 온도: val['t09'], 습도: val['t09'] },
          { 시간: "10시", 온도: val['t10'], 습도: val['t10'] },
          { 시간: "11시", 온도: val['t11'], 습도: val['t11'] },
          { 시간: "12시", 온도: val['t12'], 습도: val['t12'] },
          { 시간: "13시", 온도: val['t13'], 습도: val['t13'] },
          { 시간: "14시", 온도: val['t14'], 습도: val['t14'] },
          { 시간: "15시", 온도: val['t15'], 습도: val['t15'] },
          { 시간: "16시", 온도: val['t16'], 습도: val['t16'] },
          { 시간: "17시", 온도: val['t17'], 습도: val['t17'] },
          { 시간: "18시", 온도: val['t18'], 습도: val['t18'] },
          { 시간: "19시", 온도: val['t19'], 습도: val['t19'] },
          { 시간: "20시", 온도: val['t20'], 습도: val['t20'] },
          { 시간: "21시", 온도: val['t21'], 습도: val['t21'] },
          { 시간: "22시", 온도: val['t22'], 습도: val['t22'] },
          { 시간: "23시", 온도: val['t23'], 습도: val['t23'] }
        ]
      });
    }

    //<!-- Google Chart -->
    google.load("visualization", "1", { packages: ["corechart"] });
    google.setOnLoadCallback(drawChart);
    function drawChart(val, dataTypeName) {
      var data = google.visualization.arrayToDataTable([
        ['Time', dataTypeName],
        ['0시',  val['t00']],
        ['',     val['t01']],
        ['2시',  val['t02']],
        ['',     val['t03']],
        ['4시',  val['t04']],
        ['',     val['t05']],
        ['6시',  val['t06']],
        ['',     val['t07']],
        ['8시',  val['t08']],
        ['',     val['t09']],
        ['10시', val['t10']],
        ['',     val['t11']],
        ['12시', val['t12']],
        ['',     val['t13']],
        ['14시', val['t14']],
        ['',     val['t15']],
        ['16시', val['t16']],
        ['',     val['t17']],
        ['18시', val['t18']],
        ['',     val['t19']],
        ['20시', val['t20']],
        ['',     val['t21']],
        ['22시', val['t22']],
        ['',     val['t23']]
      ]);

      var options = {
        title: dataTypeName+' 그래프'
      };
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
  </script>

</head>

<body>

  <div id="wrap">
    <div id="mainText">
      <h1>로지시스템 신입사원 프로젝트(시간별 온·습도 예측값)</h1>
    </div>

    <!-- Jq Grid -->
    <div id="reloadDiv">
      <div id="outerDiv" style="margin: 5px;">
        <table id="list"></table>
      </div>
    </div>

    <div id="selectArea">
      <input type="date" id="dateSelect">
      <select name="typeSelect" id="typeSelect">
        <option value="온도">온도</option>
        <option value="습도">습도</option>
      </select>
    </div>

    <!-- Google Chart -->
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
  </div>

</body>

</html>